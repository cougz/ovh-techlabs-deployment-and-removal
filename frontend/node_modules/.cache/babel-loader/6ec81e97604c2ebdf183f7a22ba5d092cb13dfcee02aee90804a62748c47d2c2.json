{"ast":null,"code":"import React,{useState,useRef}from'react';import{useParams,useNavigate,Link}from'react-router-dom';import{useQuery,useMutation,useQueryClient}from'react-query';import{CalendarIcon,UserGroupIcon,PlusIcon,TrashIcon,PlayIcon,StopIcon,CheckCircleIcon,ClockIcon,EllipsisVerticalIcon,ArrowLeftIcon,PencilIcon,DocumentArrowDownIcon,XMarkIcon,ExclamationTriangleIcon}from'@heroicons/react/24/outline';import{workshopApi,attendeeApi,deploymentApi}from'../services/api';import DropdownMenu from'../components/DropdownMenu';import DeploymentLogs from'../components/DeploymentLogs';import EditDeletionDateDialog from'../components/EditDeletionDateDialog';import{useWebSocket}from'../hooks/useWebSocket';import useConfirmDialog from'../hooks/useConfirmDialog';import useNotificationDialog from'../hooks/useNotificationDialog';// Error boundary component for debugging\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";class ErrorBoundary extends React.Component{constructor(props){super(props);this.state={hasError:false};}static getDerivedStateFromError(error){return{hasError:true,error};}componentDidCatch(error,errorInfo){console.error('WorkshopDetail Error:',error,errorInfo);}render(){if(this.state.hasError){var _this$state$error;return this.props.fallback||/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500 text-lg font-semibold\",children:\"Something went wrong\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-600 mt-2\",children:((_this$state$error=this.state.error)===null||_this$state$error===void 0?void 0:_this$state$error.message)||'An error occurred in the workshop detail page'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),className:\"mt-4 btn-primary\",children:\"Reload Page\"})]});}return/*#__PURE__*/_jsx(_Fragment,{children:this.props.children});}}const WorkshopDetail=()=>{const{id}=useParams();const navigate=useNavigate();const queryClient=useQueryClient();// Add debugging\nconsole.log('WorkshopDetail render - ID:',id);const[showAddAttendee,setShowAddAttendee]=useState(false);const[showActions,setShowActions]=useState(null);const[newAttendee,setNewAttendee]=useState({username:'',email:''});const[deploymentProgress]=useState({});const[isExporting,setIsExporting]=useState(false);const[isCleanupInProgress,setIsCleanupInProgress]=useState(false);const[showEditDeletionDate,setShowEditDeletionDate]=useState(false);const attendeeTriggerRefs=useRef({});// Confirmation dialogs\nconst{ConfirmDialog,showConfirmDialog}=useConfirmDialog();// Notification dialogs\nconst{NotificationDialog,showNotification}=useNotificationDialog();// WebSocket for real-time updates\nuseWebSocket({workshopId:id||'',onStatusUpdate:(entityType,entityId,status,details)=>{console.log(`WebSocket status update: ${entityType} ${entityId} -> ${status}`,details);// React Query cache invalidation is handled inside useWebSocket hook\n},onDeploymentLog:(attendeeId,logEntry)=>{console.log(`WebSocket deployment log for ${attendeeId}:`,logEntry);// Invalidate deployment logs to refetch\nqueryClient.invalidateQueries(['deployment-logs',id]);},onDeploymentProgress:(attendeeId,progress,currentStep)=>{console.log(`WebSocket deployment progress for ${attendeeId}: ${progress}% - ${currentStep}`);// Real-time progress updates could be stored in component state if needed\n}});// Fetch workshop details\nconst{data:workshop,isLoading:workshopLoading,error:workshopError}=useQuery(['workshop',id],()=>workshopApi.getWorkshop(id),{enabled:!!id,refetchInterval:5000// Fixed 5-second interval to avoid circular dependency\n});// Fetch attendees\nconst{data:attendees=[],isLoading:attendeesLoading,refetch:refetchAttendees}=useQuery(['attendees',id],()=>attendeeApi.getWorkshopAttendees(id),{enabled:!!id,refetchInterval:3000// Fixed 3-second interval\n});// Fetch deployment logs for active deployments\nconst{data:deploymentLogs={}}=useQuery(['deployment-logs',id],async()=>{if(!attendees.length)return{};const logsPromises=attendees.map(async attendee=>{try{const logs=await deploymentApi.getAttendeeDeploymentLogs(attendee.id);return[attendee.id,logs];}catch(error){return[attendee.id,[]];}});const results=await Promise.all(logsPromises);return Object.fromEntries(results);},{enabled:!!id&&attendees.length>0,refetchInterval:10000// Fixed 10-second interval\n});// Add attendee mutation\nconst addAttendeeMutation=useMutation(attendeeData=>attendeeApi.createAttendee(id,attendeeData),{onSuccess:()=>{refetchAttendees();setNewAttendee({username:'',email:''});setShowAddAttendee(false);},onError:error=>{var _error$response,_error$response$data;console.error('Failed to add attendee:',error);showNotification({title:'Error',message:'Failed to add attendee: '+(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Unknown error'),type:'error'});}});// Delete attendee mutation\nconst deleteAttendeeMutation=useMutation(attendeeId=>attendeeApi.deleteAttendee(attendeeId),{onSuccess:()=>{refetchAttendees();setShowActions(null);},onError:error=>{var _error$response2,_error$response2$data;console.error('Failed to delete attendee:',error);showNotification({title:'Error',message:'Failed to delete attendee: '+(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||'Unknown error'),type:'error'});}});// Deploy workshop mutation\nconst deployWorkshopMutation=useMutation(()=>workshopApi.deployWorkshop(id),{onSuccess:()=>{queryClient.invalidateQueries(['workshop',id]);refetchAttendees();},onError:error=>{var _error$response3,_error$response3$data;console.error('Failed to deploy workshop:',error);showNotification({title:'Error',message:'Failed to deploy workshop: '+(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.detail)||'Unknown error'),type:'error'});}});// Cleanup workshop mutation\nconst cleanupWorkshopMutation=useMutation(()=>workshopApi.cleanupWorkshop(id),{onMutate:()=>{setIsCleanupInProgress(true);},onSuccess:()=>{queryClient.invalidateQueries(['workshop',id]);refetchAttendees();setIsCleanupInProgress(false);},onError:error=>{var _error$response4,_error$response4$data;console.error('Failed to cleanup workshop:',error);showNotification({title:'Error',message:'Failed to cleanup workshop: '+(((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.detail)||'Unknown error'),type:'error'});setIsCleanupInProgress(false);}});// Update workshop mutation\nconst updateWorkshopMutation=useMutation(data=>{// Convert null to undefined for API compatibility\nconst apiData={};if(data.deletion_scheduled_at!==null){apiData.deletion_scheduled_at=data.deletion_scheduled_at;}return workshopApi.updateWorkshop(id,apiData);},{onSuccess:()=>{queryClient.invalidateQueries(['workshop',id]);showNotification({title:'Success',message:'Deletion date updated successfully',type:'success'});},onError:error=>{var _error$response5,_error$response5$data;console.error('Failed to update workshop:',error);showNotification({title:'Error',message:'Failed to update deletion date: '+(((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.detail)||'Unknown error'),type:'error'});}});// Delete workshop mutation\nconst deleteWorkshopMutation=useMutation(()=>workshopApi.deleteWorkshop(id),{onSuccess:()=>{queryClient.invalidateQueries('workshops');navigate('/workshops');},onError:error=>{var _error$response6,_error$response6$data;console.error('Failed to delete workshop:',error);showNotification({title:'Error',message:'Failed to delete workshop: '+(((_error$response6=error.response)===null||_error$response6===void 0?void 0:(_error$response6$data=_error$response6.data)===null||_error$response6$data===void 0?void 0:_error$response6$data.detail)||'Unknown error'),type:'error'});}});const getStatusIcon=status=>{switch(status){case'active':return/*#__PURE__*/_jsx(CheckCircleIcon,{className:\"h-5 w-5 text-success-500\"});case'deploying':return/*#__PURE__*/_jsx(ClockIcon,{className:\"h-5 w-5 text-warning-500 animate-spin\"});case'failed':return/*#__PURE__*/_jsx(XMarkIcon,{className:\"h-5 w-5 text-danger-500\"});case'deleting':return/*#__PURE__*/_jsx(ClockIcon,{className:\"h-5 w-5 text-danger-500 animate-spin\"});default:return/*#__PURE__*/_jsx(ClockIcon,{className:\"h-5 w-5 text-gray-500\"});}};const getStatusClass=status=>{switch(status){case'active':return'status-active';case'deploying':return'status-deploying';case'failed':return'status-failed';case'deleting':return'status-deleting';default:return'status-planning';}};const handleAddAttendee=e=>{e.preventDefault();if(!newAttendee.username.trim()||!newAttendee.email.trim()){showNotification({title:'Validation Error',message:'Please fill in all fields',type:'warning'});return;}addAttendeeMutation.mutate(newAttendee);};const handleDeployWorkshop=()=>{if(attendees.length===0){showNotification({title:'Validation Error',message:'Please add attendees before deploying the workshop',type:'warning'});return;}showConfirmDialog({title:'Deploy Workshop',message:`Deploy workshop resources for ${attendees.length} attendees?`,onConfirm:()=>deployWorkshopMutation.mutate(),variant:'default',confirmLabel:'Deploy'});};const handleCleanupWorkshop=()=>{if(isCleanupInProgress){return;// Prevent multiple clicks\n}showConfirmDialog({title:'Cleanup Resources',message:'This will destroy all workshop resources. Are you sure?',onConfirm:()=>{setIsCleanupInProgress(true);cleanupWorkshopMutation.mutate();},variant:'danger',confirmLabel:'Cleanup'});};const handleDeleteWorkshop=()=>{const activeAttendees=attendees.filter(a=>['active','deploying'].includes(a.status));if(activeAttendees.length>0){showNotification({title:'Cannot Delete',message:'Cannot delete workshop with active deployments. Please cleanup resources first.',type:'warning'});return;}showConfirmDialog({title:'Delete Workshop',message:'This will permanently delete the workshop. Are you sure?',onConfirm:()=>deleteWorkshopMutation.mutate(),variant:'danger',confirmLabel:'Delete'});};const handleExportAttendees=async()=>{if(!workshop){showNotification({title:'Error',message:'Workshop data not available',type:'error'});return;}setIsExporting(true);try{// Filter for only deployed attendees (active status)\nconst activeAttendees=attendees.filter(a=>a.status==='active');if(activeAttendees.length===0){// Create export file with no deployed environments message\nconst content=`${workshop.name} - Attendee List\\n\\nNo deployed attendee environments found.`;const blob=new Blob([content],{type:'text/plain'});const url=URL.createObjectURL(blob);const link=document.createElement('a');link.href=url;link.download=`${workshop.name} - Attendee List - ${new Date().toISOString().split('T')[0]}.txt`;document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);return;}// Fetch credentials for all active attendees\nconst credentialsPromises=activeAttendees.map(attendee=>attendeeApi.getAttendeeCredentials(attendee.id));const credentials=await Promise.all(credentialsPromises);// Format the export data\nlet content=`${workshop.name} - Attendee List\\n\\n`;credentials.forEach((cred,index)=>{const attendee=activeAttendees[index];content+=`Username: ${cred.username}\\n`;content+=`Email: ${attendee.email}\\n`;content+=`Password: ${cred.password}\\n`;if(cred.ovh_project_id){content+=`Project ID: ${cred.ovh_project_id}\\n`;}content+=`\\n`;});// Create and trigger download\nconst blob=new Blob([content],{type:'text/plain'});const url=URL.createObjectURL(blob);const link=document.createElement('a');link.href=url;link.download=`${workshop.name} - Attendee List - ${new Date().toISOString().split('T')[0]}.txt`;document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);}catch(error){console.error('Failed to export attendee list:',error);showNotification({title:'Export Failed',message:'Failed to export attendee list: '+(error instanceof Error?error.message:'Unknown error'),type:'error'});}finally{setIsExporting(false);}};// Handle missing ID\nif(!id){return/*#__PURE__*/_jsx(\"div\",{className:\"animate-fade-in\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(XMarkIcon,{className:\"mx-auto h-12 w-12 text-danger-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-2 text-sm font-medium text-gray-900\",children:\"Invalid Workshop ID\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:\"No workshop ID provided in the URL.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6\",children:/*#__PURE__*/_jsx(Link,{to:\"/workshops\",className:\"btn-primary\",children:\"Back to Workshops\"})})]})})})});}if(workshopLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"animate-fade-in\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"animate-pulse\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-8 bg-gray-200 rounded w-1/3 mb-4\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-4 bg-gray-200 rounded w-1/2 mb-8\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-32 bg-gray-200 rounded\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-64 bg-gray-200 rounded\"})]})]})});}if(workshopError||!workshop){return/*#__PURE__*/_jsxs(\"div\",{className:\"animate-fade-in\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/workshops\",className:\"inline-flex items-center text-sm text-primary-600 hover:text-primary-500 mb-4\",children:[/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"h-4 w-4 mr-1\"}),\"Back to Workshops\"]}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:\"Workshop Not Found\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(XMarkIcon,{className:\"mx-auto h-12 w-12 text-danger-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-2 text-sm font-medium text-gray-900\",children:\"Workshop not found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:\"The workshop you're looking for doesn't exist or has been deleted.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6\",children:/*#__PURE__*/_jsx(Link,{to:\"/workshops\",className:\"btn-primary\",children:\"Back to Workshops\"})})]})})})]});}const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'});};const formatDeletionDate=dateString=>{try{return new Date(dateString).toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric',hour:'numeric',minute:'2-digit',hour12:true});}catch(error){console.error('Invalid deletion date:',dateString,error);return'Invalid date';}};const activeAttendees=attendees.filter(a=>a.status==='active').length;const failedAttendees=attendees.filter(a=>a.status==='failed').length;// Check if all attendees are actually deployed (handles edge case where workshop status is stale)\nconst hasDeployedAttendees=activeAttendees>0;// Check if resources need cleanup (active or failed attendees that haven't been deleted)\nconst needsCleanup=attendees.some(a=>['active','failed'].includes(a.status));// Dynamic status logic based on actual attendee states\nconst deployingAttendees=attendees.filter(a=>a.status==='deploying').length;const allAttendeesDeployed=attendees.length>0&&attendees.every(a=>a.status==='active');const noAttendeesDeployed=attendees.length>0&&attendees.every(a=>a.status==='planning');const partiallyDeployed=attendees.length>0&&!allAttendeesDeployed&&!noAttendeesDeployed&&deployingAttendees===0;// Calculate effective status message based on workshop status and attendee states\nconst getEffectiveStatusMessage=()=>{// If workshop status is not planning, use the regular status logic\nif(workshop.status!=='planning'){if(workshop.status==='deploying'||deployingAttendees>0)return'Deployment in progress';if(workshop.status==='active')return'Workshop running';if(workshop.status==='completed'&&needsCleanup)return'Workshop completed - resources active';if(workshop.status==='completed'&&!needsCleanup)return'Workshop completed - resources cleaned up';if(workshop.status==='failed')return'Deployment failed';if(workshop.status==='deleting')return'Cleanup in progress';}// Special logic for planning status - check actual attendee deployment states\nif(workshop.status==='planning'){if(deployingAttendees>0)return'Deployment in progress';if(allAttendeesDeployed)return'All attendees deployed';if(partiallyDeployed)return'Partially deployed';if(noAttendeesDeployed)return'Ready to deploy';}return'Ready to deploy';// fallback\n};// Calculate effective status for header display (simple status string)\nconst getEffectiveStatus=()=>{// If workshop status is not planning, use the regular status logic\nif(workshop.status!=='planning'){if(workshop.status==='deploying'||deployingAttendees>0)return'deploying';if(workshop.status==='active')return'active';if(workshop.status==='completed')return'completed';if(workshop.status==='failed')return'failed';if(workshop.status==='deleting')return'deleting';}// Special logic for planning status - check actual attendee deployment states\nif(workshop.status==='planning'){if(deployingAttendees>0)return'deploying';if(allAttendeesDeployed)return'active';if(partiallyDeployed)return'deploying';// Show as deploying for partially deployed\nif(noAttendeesDeployed)return'planning';}return'planning';// fallback\n};return/*#__PURE__*/_jsxs(ErrorBoundary,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"animate-fade-in\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/workshops\",className:\"inline-flex items-center text-sm text-primary-600 hover:text-primary-500 mb-4\",children:[/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"h-4 w-4 mr-1\"}),\"Back to Workshops\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row lg:justify-between lg:items-start gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[getStatusIcon(getEffectiveStatus()),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 truncate\",children:workshop.name}),/*#__PURE__*/_jsx(\"span\",{className:`${getStatusClass(getEffectiveStatus())} whitespace-nowrap flex-shrink-0`,children:getEffectiveStatus()})]}),workshop.description&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-gray-600\",children:workshop.description})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-3 flex-shrink-0\",children:[workshop.status==='planning'&&attendees.length>0&&!allAttendeesDeployed&&deployingAttendees===0&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleDeployWorkshop,disabled:deployWorkshopMutation.isLoading,className:\"btn-primary whitespace-nowrap\",children:[/*#__PURE__*/_jsx(PlayIcon,{className:\"h-4 w-4 mr-2\"}),deployWorkshopMutation.isLoading?'Deploying...':'Deploy Workshop']}),needsCleanup&&(workshop.status==='active'||workshop.status==='completed'||hasDeployedAttendees)&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleCleanupWorkshop,disabled:isCleanupInProgress,className:\"btn-danger whitespace-nowrap\",children:[/*#__PURE__*/_jsx(StopIcon,{className:\"h-4 w-4 mr-2\"}),isCleanupInProgress?'Cleaning up...':'Cleanup Resources']}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleDeleteWorkshop,disabled:deleteWorkshopMutation.isLoading,className:\"btn-danger whitespace-nowrap\",children:[/*#__PURE__*/_jsx(TrashIcon,{className:\"h-4 w-4 mr-2\"}),deleteWorkshopMutation.isLoading?'Deleting...':'Delete Workshop']})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6 mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"h-8 w-8 text-primary-500 mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Schedule\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[formatDate(workshop.start_date),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"to\"}),\" \",formatDate(workshop.end_date)]})]})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(UserGroupIcon,{className:\"h-8 w-8 text-success-500 mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Attendees\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[attendees.length,\" total\",activeAttendees>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-success-600\",children:[\" \\u2022 \",activeAttendees,\" active\"]}),failedAttendees>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-danger-600\",children:[\" \\u2022 \",failedAttendees,\" failed\"]})]})]})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CheckCircleIcon,{className:\"h-8 w-8 text-warning-500 mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Status\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:getEffectiveStatusMessage()})]})]})})}),workshop.deletion_scheduled_at?/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(ExclamationTriangleIcon,{className:\"h-8 w-8 text-amber-500 mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Cleanup Schedule\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"Environment deletion\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-medium text-amber-600\",children:formatDeletionDate(workshop.deletion_scheduled_at)})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowEditDeletionDate(true),className:\"text-blue-600 hover:text-blue-700 p-2\",title:\"Edit deletion date\",children:/*#__PURE__*/_jsx(PencilIcon,{className:\"h-5 w-5\"})})]})})}):/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"h-8 w-8 text-gray-400 mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Cleanup Schedule\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"No automatic cleanup scheduled\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowEditDeletionDate(true),className:\"text-blue-600 hover:text-blue-700 p-2\",title:\"Set deletion date\",children:/*#__PURE__*/_jsx(PlusIcon,{className:\"h-5 w-5\"})})]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg leading-6 font-medium text-gray-900\",children:[\"Attendees (\",attendees.length,\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleExportAttendees,disabled:isExporting,className:\"btn-secondary\",children:[/*#__PURE__*/_jsx(DocumentArrowDownIcon,{className:\"h-4 w-4 mr-2\"}),isExporting?'Exporting...':'Export Attendee List']}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowAddAttendee(true),className:\"btn-primary\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-4 w-4 mr-2\"}),\"Add Attendee\"]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[showAddAttendee&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 p-4 bg-gray-50 rounded-lg\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleAddAttendee,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Username *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newAttendee.username,onChange:e=>setNewAttendee(prev=>({...prev,username:e.target.value})),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm\",placeholder:\"e.g., john-doe\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Email *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:newAttendee.email,onChange:e=>setNewAttendee(prev=>({...prev,email:e.target.value})),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm\",placeholder:\"john-doe@example.com\",required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setShowAddAttendee(false);setNewAttendee({username:'',email:''});},className:\"btn-secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:addAttendeeMutation.isLoading,className:\"btn-primary\",children:addAttendeeMutation.isLoading?'Adding...':'Add Attendee'})]})]})}),attendeesLoading?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:[...Array(3)].map((_,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"animate-pulse flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-10 w-10 bg-gray-200 rounded-full\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-4 bg-gray-200 rounded w-1/4 mb-2\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-3 bg-gray-200 rounded w-1/3\"})]})]},i))}):attendees.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(UserGroupIcon,{className:\"mx-auto h-12 w-12 text-gray-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-2 text-sm font-medium text-gray-900\",children:\"No attendees\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:\"Add attendees to get started with your workshop.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:attendees.map(attendee=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[getStatusIcon(attendee.status),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-900\",children:attendee.username}),/*#__PURE__*/_jsx(\"span\",{className:`${getStatusClass(attendee.status)} text-xs`,children:attendee.status})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:attendee.email}),attendee.ovh_project_id&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-400\",children:[\"Project: \",attendee.ovh_project_id]}),attendee.deletion_scheduled_at&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-amber-600 dark:text-amber-400\",children:[\"Will be deleted on \",formatDeletionDate(attendee.deletion_scheduled_at)]}),deploymentProgress[attendee.id]&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-xs text-gray-600 mb-1\",children:[/*#__PURE__*/_jsx(\"span\",{children:deploymentProgress[attendee.id].step}),/*#__PURE__*/_jsxs(\"span\",{children:[deploymentProgress[attendee.id].progress,\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-primary-600 h-2 rounded-full transition-all duration-300\",style:{width:`${deploymentProgress[attendee.id].progress}%`}})})]}),/*#__PURE__*/_jsx(ErrorBoundary,{fallback:/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-400\",children:\"Logs unavailable\"}),children:/*#__PURE__*/_jsx(DeploymentLogs,{logs:deploymentLogs[attendee.id]||[],isLoading:false})})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{ref:el=>{attendeeTriggerRefs.current[attendee.id]=el;},onClick:()=>setShowActions(showActions===attendee.id?null:attendee.id),className:\"p-2 text-gray-400 hover:text-gray-600 rounded-md hover:bg-gray-50\",children:/*#__PURE__*/_jsx(EllipsisVerticalIcon,{className:\"h-5 w-5\"})}),/*#__PURE__*/_jsx(ErrorBoundary,{fallback:/*#__PURE__*/_jsx(\"div\",{children:\"Menu error\"}),children:/*#__PURE__*/_jsx(DropdownMenu,{isOpen:showActions===attendee.id,onClose:()=>setShowActions(null),trigger:{current:attendeeTriggerRefs.current[attendee.id]},children:/*#__PURE__*/_jsxs(\"div\",{className:\"py-1\",children:[/*#__PURE__*/_jsxs(Link,{to:`/attendees/${attendee.id}`,className:\"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50\",onClick:()=>setShowActions(null),children:[/*#__PURE__*/_jsx(PencilIcon,{className:\"h-4 w-4 mr-2\"}),\"View Details\"]}),attendee.status!=='deleting'&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{setShowActions(null);showConfirmDialog({title:'Remove Attendee',message:`Remove ${attendee.username} from the workshop?`,onConfirm:()=>deleteAttendeeMutation.mutate(attendee.id),variant:'danger',confirmLabel:'Remove'});},className:\"flex items-center w-full px-4 py-2 text-sm text-danger-600 hover:bg-danger-50\",children:[/*#__PURE__*/_jsx(TrashIcon,{className:\"h-4 w-4 mr-2\"}),\"Remove Attendee\"]})]})})})]})]},attendee.id))})]})]})]}),/*#__PURE__*/_jsx(ConfirmDialog,{}),/*#__PURE__*/_jsx(NotificationDialog,{}),workshop&&/*#__PURE__*/_jsx(EditDeletionDateDialog,{isOpen:showEditDeletionDate,onClose:()=>setShowEditDeletionDate(false),onConfirm:date=>{updateWorkshopMutation.mutate({deletion_scheduled_at:date});setShowEditDeletionDate(false);},currentDate:workshop.deletion_scheduled_at,workshopName:workshop.name,workshopEndDate:workshop.end_date})]});};export default WorkshopDetail;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}